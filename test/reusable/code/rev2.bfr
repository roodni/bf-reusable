main {
  buf: array(_) {
    c: cell;
    p: index;
  };
} in

$alloc { f } in

$let input_end = '\n' in
$let p = buf@p in
$let c = p:c in

+ f
! f [
  , c
  - c input_end
  ? c [] [
    - f
  ]
  + c input_end
  > p
]

< p
! p [
  < p
  . c
]
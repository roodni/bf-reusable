open import "std.bfr"

let gen_ifelse cond the_st els_st = [
  $alloc { els; bu }
  + els
  ! cond [
    - els
    *the_st
    *gen_repeat cond [ + bu ]
  ]
  *gen_repeat bu [ + cond ]
  ! els [
    - els
    *els_st
  ]
]

codegen $

$build { x; a }

+ a '0'

*gen_geti x '\n'

*gen_ifelse x
  [ - x
    *gen_ifelse x
      [ $put a ]
      [ + a 1  $put a ]
  ]
  [
    *gen_geti x '\n'
    *gen_ifelse x
      [ + a 2  $put a ]
      [ + a 3  $put a ]
  ]
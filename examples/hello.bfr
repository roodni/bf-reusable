// Hello World!

// 不動点コンビネータ
let fix f =
  let g x = f (fun y -> x x y) in
  g g

// 文字列を引数に取り、それを出力する文列を返す
let gen_puts s = [
  $alloc { c }
  *fix
    (fun loop prev l -> match l with
      | () -> []
      | hd :: tl -> [
          + c (hd - prev)
          $put c
          *loop hd tl
        ]
    )
    0 (string_to_list s)
]

codegen [ *gen_puts "Hello World!\n" ]
// Hello World!

// 文字列を引数に取り、それを出力する命令列を返す
let gen_puts s = [
  $alloc { c }
  **let len = string_length s in
    let rec loop i prev =
      if i < len then
        let curr = string_get s i in
        [
          + c (curr - prev)
          . c
          *loop (i + 1) curr
        ]
      else []
    in
    loop 0 0
]

let main = gen_puts "Hello World!\n"